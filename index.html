<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blinds Measurement & Quote</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 12px;
    background: #f8f9fa;
    max-width: 900px;
    margin: auto;
  }
  h2 {
    text-align: center;
    margin-bottom: 12px;
  }
  label {
    font-weight: bold;
    margin-top: 8px;
    display: block;
  }
  input[type=text], input[type=number], select {
    width: 100%;
    padding: 6px;
    box-sizing: border-box;
    margin-top: 3px;
  }
  button {
    padding: 10px 15px;
    margin-top: 12px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    border-radius: 4px;
    background-color: #007bff;
    color: white;
  }
  button:hover {
    background-color: #0056b3;
  }
  .delete-btn {
    background-color: #dc3545 !important;
    margin-top: 24px;
  }
  .delete-btn:hover {
    background-color: #a71d2a !important;
  }
  .window-row {
    background: white;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 14px;
    box-shadow: 0 0 6px #ccc;
  }
  .window-flex {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }
  .window-flex > div {
    flex: 1 1 120px;
    min-width: 120px;
  }
  .window-flex > div.full-width {
    flex-basis: 100%;
  }
  .summary {
    background: white;
    padding: 12px;
    border-radius: 8px;
    margin-top: 20px;
    box-shadow: 0 0 6px #ccc;
  }
  @media (max-width: 600px) {
    .window-flex > div {
      flex-basis: 100%;
    }
  }
</style>
</head>
<body>

<h2>Blinds Measurement & Quote</h2>

<label for="quoteDate">Date:</label>
<input type="date" id="quoteDate" />

<label for="customerName">Customer Name:</label>
<input type="text" id="customerName" placeholder="Enter customer name" />

<button id="addWindowBtn">+ Add Window</button>

<div id="windowsContainer"></div>

<div class="summary">
  <h3>Totals</h3>
  <p><strong>Total Area:</strong> <span id="totalArea">0.0000</span> m²</p>
  <p><strong>Total Price:</strong> $<span id="totalPrice">0.00</span></p>
</div>

<div class="summary" id="quoteSummary" style="display:none;">
  <h3>Quote Summary</h3>
  <p><strong>Date:</strong> <span id="summaryDate"></span></p>
  <p><strong>Customer Name:</strong> <span id="summaryCustomer"></span></p>
  <p><strong>Total Area:</strong> <span id="summaryArea"></span> m²</p>
  <p><strong>Total Price:</strong> $<span id="summaryPrice"></span></p>
</div>

<button id="exportBtn">Export to Excel</button>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script>
  // Set today as default date
  document.getElementById('quoteDate').value = new Date().toISOString().slice(0,10);

  const windowsContainer = document.getElementById('windowsContainer');
  const totalAreaEl = document.getElementById('totalArea');
  const totalPriceEl = document.getElementById('totalPrice');
  const quoteSummary = document.getElementById('quoteSummary');
  const summaryDate = document.getElementById('summaryDate');
  const summaryCustomer = document.getElementById('summaryCustomer');
  const summaryArea = document.getElementById('summaryArea');
  const summaryPrice = document.getElementById('summaryPrice');

  function createWindowRow() {
    const div = document.createElement('div');
    div.className = 'window-row';

    div.innerHTML = `
      <div class="window-flex">
        <div>
          <label>Window Name</label>
          <input type="text" class="win-name" placeholder="Window name" />
        </div>
        <div>
          <label>Blind Type</label>
          <select class="win-blind-type">
            <option value="Zebra">Zebra</option>
            <option value="Roller">Roller</option>
            <option value="Shangri-La">Shangri-La</option>
          </select>
        </div>
        <div>
          <label>Cassette Shape</label>
          <select class="win-cassette">
            <option value="Round">Round</option>
            <option value="Square">Square</option>
          </select>
        </div>
        <div>
          <label>Fabric Type</label>
          <input type="text" class="win-fabric" placeholder="Fabric type" />
        </div>
        <div>
          <label>Chain/Motor Side</label>
          <select class="win-chain-side">
            <option value="Right">Right</option>
            <option value="Left">Left</option>
          </select>
        </div>
        <div>
          <label>Width (m)</label>
          <input type="number" class="win-width" step="0.0001" min="0" placeholder="Width" />
        </div>
        <div>
          <label>Length (m)</label>
          <input type="number" class="win-length" step="0.0001" min="0" placeholder="Length" />
        </div>
        <div>
          <label>Motorized</label>
          <select class="win-motorized">
            <option value="No">No</option>
            <option value="Yes">Yes</option>
          </select>
        </div>
        <div style="flex-basis:100px; display:flex; flex-direction: column; justify-content:center; align-items:center;">
          <label>Area (m²)</label>
          <div class="win-area" style="font-weight:bold; margin-top:6px;">0.0000</div>
        </div>
        <div style="flex-basis:120px; display:flex; flex-direction: column; justify-content:center; align-items:center;">
          <label>Price ($)</label>
          <div class="win-price" style="font-weight:bold; margin-top:6px;">0.00</div>
        </div>
        <div style="flex-basis:50px; display:flex; flex-direction: column; justify-content:center; align-items:center;">
          <button class="delete-btn" title="Delete Window">&times;</button>
        </div>
      </div>
    `;

    // Attach event listeners for live updates
    const inputs = div.querySelectorAll('input, select');
    inputs.forEach(input => {
      input.addEventListener('input', updateAll);
      input.addEventListener('change', updateAll);
    });

    // Delete button event
    div.querySelector('.delete-btn').addEventListener('click', () => {
      windowsContainer.removeChild(div);
      updateAll();
    });

    return div;
  }

  function addWindow() {
    const newRow = createWindowRow();
    windowsContainer.appendChild(newRow);
    updateAll();
  }

  function updateAll() {
    let totalArea = 0;
    let totalPrice = 0;

    [...windowsContainer.children].forEach(div => {
      const width = parseFloat(div.querySelector('.win-width').value) || 0;
      const length = parseFloat(div.querySelector('.win-length').value) || 0;
      const motorized = div.querySelector('.win-motorized').value === "Yes";

      const area = width * length;
      let price = area * 35;
      if (motorized) price += 100;

      totalArea += area;
      totalPrice += price;

      // Update per window area & price display
      div.querySelector('.win-area').textContent = area.toFixed(4);
      div.querySelector('.win-price').textContent = price.toFixed(2);
    });

    totalAreaEl.textContent = totalArea.toFixed(4);
    totalPriceEl.textContent = totalPrice.toFixed(2);

    // Update quote summary
    summaryDate.textContent = document.getElementById('quoteDate').value || "";
    summaryCustomer.textContent = document.getElementById('customerName').value.trim() || "";
    summaryArea.textContent = totalArea.toFixed(4);
    summaryPrice.textContent = totalPrice.toFixed(2);
    quoteSummary.style.display = (totalArea > 0) ? 'block' : 'none';
  }

  document.getElementById('exportBtn').addEventListener('click', () => {
    const date = document.getElementById('quoteDate').value;
    const customer = document.getElementById('customerName').value.trim();

    if (!date) {
      alert('Please select a date.');
      return;
    }
    if (!customer) {
      alert('Please enter customer name.');
      return;
    }
    if (windowsContainer.children.length === 0) {
      alert('Add at least one window.');
      return;
    }

    const data = [];
    // Header row
    data.push([
      "Date", "Customer Name", "Window Name", "Blind Type", "Cassette Shape", "Fabric Type", "Chain/Motor Side",
      "Width (m)", "Length (m)", "Motorized", "Area (m²)", "Price ($)"
    ]);

    // Data rows
    [...windowsContainer.children].forEach(div => {
      data.push([
        date,
        customer,
        div.querySelector('.win-name').value.trim(),
        div.querySelector('.win-blind-type').value,
        div.querySelector('.win-cassette').value,
        div.querySelector('.win-fabric').value,
        div.querySelector('.win-chain-side').value,
        parseFloat(div.querySelector('.win-width').value) || 0,
        parseFloat(div.querySelector('.win-length').value) || 0,
        div.querySelector('.win-motorized').value,
        parseFloat(div.querySelector('.win-area').textContent),
        parseFloat(div.querySelector('.win-price').textContent)
      ]);
    });

    // Totals row
    data.push([
      "", "", "TOTAL", "", "", "", "",
      "", "",
      "",
      parseFloat(totalAreaEl.textContent),
      parseFloat(totalPriceEl.textContent)
    ]);

    // Generate worksheet & workbook
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Blinds Quote");

    // Filename safe version of customer name
    const safeCustomer = customer.replace(/[^\w]/g, '_');
    XLSX.writeFile(wb, `Blinds_Quote_${safeCustomer}_${date}.xlsx`);
  });

  document.getElementById('addWindowBtn').addEventListener('click', addWindow);

  // Add initial window on page load
  addWindow();

</script>

</body>
</html>
